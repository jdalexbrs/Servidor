<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>Postulaci√≥n GodestMC</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:"Poppins",sans-serif;
  min-height:100vh;
  background:#0a0e27;
  display:flex;justify-content:center;align-items:center;
  padding:20px;color:#f1f5f9;
  position:relative;
  overflow-x:hidden;
}

/* Part√≠culas de fondo */
.particles{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0}
.particle{position:absolute;width:3px;height:3px;background:rgba(14,165,233,.6);border-radius:50%;animation:float 20s infinite}
@keyframes float{
  0%,100%{transform:translateY(0) translateX(0);opacity:0}
  10%{opacity:1}
  90%{opacity:1}
  100%{transform:translateY(-100vh) translateX(50px);opacity:0}
}

/* Gradiente animado */
body::before{
  content:'';position:absolute;top:0;left:0;right:0;bottom:0;
  background:linear-gradient(135deg,#0f172a,#1e3a8a,#0ea5e9,#7c3aed);
  background-size:400% 400%;
  animation:bgFlow 15s ease infinite;
  z-index:0;
}
@keyframes bgFlow{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}

.container{
  position:relative;z-index:1;
  width:100%;max-width:700px;
  background:rgba(15,23,42,0.85);
  border-radius:24px;
  padding:40px;
  backdrop-filter:blur(20px);
  box-shadow:0 20px 60px rgba(0,0,0,.6),0 0 0 1px rgba(255,255,255,.1);
  animation:fadeIn .8s ease,float-up 2s ease infinite alternate;
  border:2px solid rgba(14,165,233,.3);
}
@keyframes fadeIn{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
@keyframes float-up{from{transform:translateY(0)}to{transform:translateY(-5px)}}

.theme-toggle{position:absolute;top:20px;right:20px;background:rgba(255,255,255,.1);border:none;border-radius:12px;padding:10px;cursor:pointer;font-size:1.2rem;transition:.3s}
.theme-toggle:hover{background:rgba(255,255,255,.2);transform:scale(1.1)}

h1{
  text-align:center;font-weight:800;font-size:2.2rem;margin-bottom:10px;
  background:linear-gradient(135deg,#38bdf8,#0ea5e9,#7c3aed);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  background-clip:text;
  text-shadow:0 0 30px rgba(14,165,233,.4);
  animation:glow 3s ease-in-out infinite;
}
@keyframes glow{0%,100%{filter:drop-shadow(0 0 10px rgba(14,165,233,.6))}50%{filter:drop-shadow(0 0 20px rgba(124,58,237,.8))}}

.subtitle{text-align:center;color:rgba(255,255,255,.7);margin-bottom:25px;font-size:.95rem}

.progress{height:12px;background:rgba(255,255,255,0.1);border-radius:999px;overflow:hidden;margin:10px 0 20px;border:1px solid rgba(255,255,255,.2)}
.progress i{display:block;height:100%;width:0%;background:linear-gradient(90deg,#0ea5e9,#38bdf8,#7c3aed);transition:width .6s cubic-bezier(.4,.0,.2,1);box-shadow:0 0 20px rgba(14,165,233,.6)}

.step-indicator{display:flex;justify-content:center;align-items:center;gap:10px;margin-bottom:20px}
.step-indicator span{color:rgba(255,255,255,.8);font-weight:600}
.timer{color:#38bdf8;font-size:.9rem}

.quality-bar{margin:15px 0;padding:12px;background:rgba(255,255,255,.05);border-radius:12px;border:1px solid rgba(255,255,255,.1)}
.quality-label{font-size:.85rem;color:rgba(255,255,255,.7);margin-bottom:6px;display:flex;justify-content:space-between}
.quality-fill{height:8px;background:rgba(255,255,255,.1);border-radius:999px;overflow:hidden}
.quality-fill div{height:100%;background:linear-gradient(90deg,#ef4444,#f59e0b,#10b981);transition:width .5s;border-radius:999px}

.step-card{display:none;animation:slideIn .5s ease;}
.step-card.active{display:block;}
@keyframes slideIn{from{opacity:0;transform:translateX(30px)}to{opacity:1;transform:translateX(0)}}

label{display:block;margin:18px 0 8px;font-size:1rem;font-weight:600;display:flex;align-items:center;gap:8px}
.required{color:#f87171;font-size:.85rem}
.char-count{margin-left:auto;font-size:.8rem;color:rgba(255,255,255,.5);font-weight:400}

input,textarea,select{
  width:100%;padding:14px;border:2px solid rgba(255,255,255,.1);border-radius:14px;
  background:rgba(255,255,255,0.08);color:#fff;font-size:1rem;outline:none;
  transition:.3s;font-family:inherit;
}
input.valid,textarea.valid,select.valid{border-color:#10b981;background:rgba(16,185,129,.1)}
input.invalid,textarea.invalid,select.invalid{border-color:#ef4444;background:rgba(239,68,68,.1)}
input::placeholder,textarea::placeholder{color:rgba(255,255,255,0.4)}
input:focus,textarea:focus,select:focus{
  background:rgba(255,255,255,0.12);
  box-shadow:0 0 0 3px rgba(14,165,233,.3);
  border-color:#0ea5e9;
  transform:scale(1.01);
}
textarea{min-height:100px;resize:vertical}
select option{background:#0f172a;color:#f1f5f9;}

.quick-options{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0}
.quick-btn{background:rgba(14,165,233,.2);border:2px solid rgba(14,165,233,.4);border-radius:10px;padding:8px 16px;color:#fff;cursor:pointer;font-size:.9rem;transition:.2s}
.quick-btn:hover{background:rgba(14,165,233,.4);transform:translateY(-2px)}

.validation-msg{font-size:.85rem;margin-top:6px;display:none}
.validation-msg.show{display:block}
.validation-msg.error{color:#f87171}
.validation-msg.success{color:#10b981}

.controls{margin-top:25px;display:flex;justify-content:space-between;gap:12px;}
.btn{
  flex:1;background:linear-gradient(135deg,#3b82f6,#0ea5e9);padding:14px;
  border:none;border-radius:14px;color:#fff;font-weight:700;font-size:1rem;
  cursor:pointer;transition:.3s;
  box-shadow:0 8px 24px rgba(14,165,233,.4);
  position:relative;overflow:hidden;
  text-transform:uppercase;letter-spacing:.5px;
}
.btn::before{
  content:'';position:absolute;top:50%;left:50%;width:0;height:0;
  border-radius:50%;background:rgba(255,255,255,.3);
  transform:translate(-50%,-50%);transition:.5s;
}
.btn:hover::before{width:300px;height:300px}
.btn:hover:not(:disabled){transform:translateY(-3px);box-shadow:0 12px 32px rgba(14,165,233,.6)}
.btn:active:not(:disabled){transform:translateY(-1px)}
.btn:disabled{opacity:0.4;cursor:not-allowed;transform:none}
.btn.ghost{background:transparent;border:2px solid rgba(255,255,255,.3);box-shadow:none;}
.btn.ghost:hover{background:rgba(255,255,255,.1)}

.success-screen{text-align:center;padding:40px 20px}
.success-screen h1{font-size:4rem;margin-bottom:20px;animation:bounce 1s ease}
@keyframes bounce{0%,100%{transform:scale(1)}50%{transform:scale(1.2)}}
.success-screen h2{font-size:1.8rem;margin-bottom:15px;color:#10b981}
.success-screen .app-id{
  display:inline-block;background:rgba(14,165,233,.2);
  padding:12px 24px;border-radius:12px;margin:20px 0;
  font-family:'Courier New',monospace;font-size:1.2rem;
  border:2px solid rgba(14,165,233,.4);
}

footer{margin-top:25px;text-align:center;font-size:.85rem;color:rgba(255,255,255,.5);display:flex;justify-content:center;align-items:center;gap:8px}
footer a{color:#38bdf8;text-decoration:none;transition:.3s}
footer a:hover{color:#0ea5e9}

body.light{background:#e0f2fe}
body.light::before{background:linear-gradient(135deg,#e0f2fe,#bae6fd,#7dd3fc)}
body.light .container{background:rgba(255,255,255,.9);color:#0f172a;border-color:rgba(14,165,233,.3)}
body.light input,body.light textarea,body.light select{background:rgba(14,165,233,.05);color:#0f172a;border-color:rgba(14,165,233,.2)}
body.light input::placeholder,body.light textarea::placeholder{color:rgba(15,23,42,0.4)}
body.light select option{background:#fff;color:#0f172a}
body.light h1{-webkit-text-fill-color:#0f172a}
body.light label{color:#0f172a}
body.light .subtitle{color:#0f172a}
body.light .step-indicator span{color:#0f172a}
body.light .quality-label{color:#0f172a}
body.light .validation-msg.error{color:#dc2626}
body.light .validation-msg.success{color:#059669}
body.light footer{color:rgba(15,23,42,.7)}
body.light .char-count{color:rgba(15,23,42,.6)}

@media(max-width:600px){
  .container{padding:25px}
  h1{font-size:1.8rem}
  .controls{flex-direction:column;}
  .btn{width:100%;}
}

/* Confetti */
.confetti{position:fixed;width:10px;height:10px;top:-10px;z-index:9999;animation:confetti-fall 3s linear}
@keyframes confetti-fall{to{transform:translateY(100vh) rotate(720deg);opacity:0}}

/* Easter egg */
.konami-active .container{animation:rainbow 2s linear infinite,spin 10s linear infinite}
@keyframes rainbow{0%{filter:hue-rotate(0deg)}100%{filter:hue-rotate(360deg)}}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>
<div class="particles" id="particles"></div>

<div class="container">
<button class="theme-toggle" id="themeToggle">üåô</button>

<h1>‚ö° Postulaciones GodestMC</h1>
<p class="subtitle">Completa el formulario para unirte al equipo</p>

<div class="progress"><i id="bar"></i></div>
<div class="step-indicator">
  <span>Pregunta <span id="currentStep">1</span> de <span id="totalSteps"></span></span>
  <span class="timer" id="timer">‚è±Ô∏è 0:00</span>
</div>

<div class="quality-bar">
  <div class="quality-label">
    <span>üìä Calidad de postulaci√≥n</span>
    <span id="qualityPercent">0%</span>
  </div>
  <div class="quality-fill"><div id="qualityBar" style="width:0%"></div></div>
</div>

<form id="applyForm">
  <!-- Pregunta 1: Rol -->
  <div class="step-card active" data-step="1">
    <label>üéØ ¬øRol al que te postulas? <span class="required">*</span></label>
    <select name="role" required>
      <option value="">‚Äî Selecciona ‚Äî</option>
      <option value="staff">Staff</option>
      <option value="dev">Dev</option>
      <option value="beta">Beta Tester</option>
    </select>
    <div class="validation-msg" id="val-role"></div>
  </div>

  <!-- Pregunta 2 -->
  <div class="step-card" data-step="2">
    <label>üí¨ Nick en Discord <span class="required">*</span></label>
    <input name="discord" required placeholder="Ej: usuario#1234 o @usuario">
    <div class="validation-msg" id="val-discord"></div>
  </div>

  <!-- Pregunta 3 -->
  <div class="step-card" data-step="3">
    <label>üéÆ Nick en Minecraft <span class="required">*</span></label>
    <input name="mc" required placeholder="Ej: jdalexbrs" minlength="3" maxlength="16">
    <div class="validation-msg" id="val-mc"></div>
  </div>

  <!-- Pregunta 4 -->
  <div class="step-card" data-step="4">
    <label>
      üìã ¬øHas sido staff/dev/beta previamente? <span class="required">*</span>
      <span class="char-count"><span id="exp-count">0</span>/500</span>
    </label>
    <textarea name="exp" required maxlength="500"></textarea>
    <div class="quick-options">
      <button type="button" class="quick-btn" data-fill="exp" data-text="S√≠, he sido staff en varios servidores">‚úÖ S√≠, tengo experiencia</button>
      <button type="button" class="quick-btn" data-fill="exp" data-text="No, esta ser√≠a mi primera vez">‚ùå No tengo experiencia</button>
    </div>
    <div class="validation-msg" id="val-exp"></div>
  </div>

  <!-- Pregunta 5 -->
  <div class="step-card" data-step="5">
    <label>üåç Pa√≠s y zona horaria <span class="required">*</span></label>
    <input name="country" required placeholder="Ej: Espa√±a (GMT+2)">
    <div class="quick-options">
      <button type="button" class="quick-btn" data-fill="country" data-text="Espa√±a (GMT+1/+2)">üá™üá∏ Espa√±a</button>
      <button type="button" class="quick-btn" data-fill="country" data-text="M√©xico (GMT-6)">üá≤üáΩ M√©xico</button>
      <button type="button" class="quick-btn" data-fill="country" data-text="Argentina (GMT-3)">üá¶üá∑ Argentina</button>
      <button type="button" class="quick-btn" data-fill="country" data-text="Colombia (GMT-5)">üá®üá¥ Colombia</button>
    </div>
    <button type="button" id="detectLocation" class="quick-btn" style="width:100%;margin-top:8px">üìç Detectar autom√°ticamente</button>
    <div class="validation-msg" id="val-country"></div>
  </div>

  <!-- Pregunta 6 -->
  <div class="step-card" data-step="6">
    <label>‚è∞ Horas semanales disponibles <span class="required">*</span></label>
    <input name="hours" type="number" required placeholder="Ej: 15" min="1" max="168">
    <div class="validation-msg" id="val-hours"></div>
  </div>

  <!-- Pregunta 7 -->
  <div class="step-card" data-step="7">
    <label>üìÖ D√≠as disponibles de la semana <span class="required">*</span></label>
    <input name="days" required placeholder="Ej: Lunes, Martes, Viernes">
    <div class="quick-options">
      <button type="button" class="quick-btn" data-fill="days" data-text="Todos los d√≠as">üóìÔ∏è Todos</button>
      <button type="button" class="quick-btn" data-fill="days" data-text="Lunes a Viernes">üìö L-V</button>
      <button type="button" class="quick-btn" data-fill="days" data-text="S√°bado y Domingo">üéÆ Fines de semana</button>
    </div>
    <div class="validation-msg" id="val-days"></div>
  </div>

  <!-- Staff -->
  <div class="step-card staff-only" data-step="8">
    <label>
      ‚öñÔ∏è ¬øC√≥mo resolver√≠as un conflicto entre usuarios? <span class="required">*</span>
      <span class="char-count"><span id="staff_conflict-count">0</span>/800</span>
    </label>
    <textarea name="staff_conflict" maxlength="800"></textarea>
    <div class="validation-msg" id="val-staff_conflict"></div>
  </div>
  <div class="step-card staff-only" data-step="9">
    <label>
      üí° ¬øPor qu√© quieres ser staff? <span class="required">*</span>
      <span class="char-count"><span id="staff_motive-count">0</span>/800</span>
    </label>
    <textarea name="staff_motive" maxlength="800"></textarea>
    <div class="validation-msg" id="val-staff_motive"></div>
  </div>

  <!-- Dev -->
  <div class="step-card dev-only" data-step="8">
    <label>
      üíª ¬øQu√© lenguajes de programaci√≥n dominas? <span class="required">*</span>
      <span class="char-count"><span id="dev_langs-count">0</span>/500</span>
    </label>
    <textarea name="dev_langs" maxlength="500"></textarea>
    <div class="quick-options">
      <button type="button" class="quick-btn" data-fill="dev_langs" data-text="Java">‚òï Java</button>
      <button type="button" class="quick-btn" data-fill="dev_langs" data-text="JavaScript">üü® JavaScript</button>
      <button type="button" class="quick-btn" data-fill="dev_langs" data-text="Python">üêç Python</button>
      <button type="button" class="quick-btn" data-fill="dev_langs" data-text="C++">‚öôÔ∏è C++</button>
    </div>
    <div class="validation-msg" id="val-dev_langs"></div>
  </div>
  <div class="step-card dev-only" data-step="9">
    <label>üîß ¬øSabes manejar eventos de Minecraft? <span class="required">*</span></label>
    <select name="dev_events">
      <option value="">‚Äî Selecciona ‚Äî</option>
      <option value="s√≠-experto">S√≠, soy experto</option>
      <option value="s√≠-intermedio">S√≠, nivel intermedio</option>
      <option value="b√°sico">Conocimientos b√°sicos</option>
      <option value="no">No, pero quiero aprender</option>
    </select>
    <div class="validation-msg" id="val-dev_events"></div>
  </div>

  <!-- Beta -->
  <div class="step-card beta-only" data-step="8">
    <label>
      üí° ¬øPor qu√© quieres ser Beta Tester? <span class="required">*</span>
      <span class="char-count"><span id="beta_motive-count">0</span>/800</span>
    </label>
    <textarea name="beta_motive" maxlength="800"></textarea>
    <div class="validation-msg" id="val-beta_motive"></div>
  </div>
  <div class="step-card beta-only" data-step="9">
    <label>
      üîç ¬øPrefieres testear mec√°nicas o reportar bugs? <span class="required">*</span>
      <span class="char-count"><span id="beta_pref-count">0</span>/500</span>
    </label>
    <textarea name="beta_pref" maxlength="500"></textarea>
    <div class="quick-options">
      <button type="button" class="quick-btn" data-fill="beta_pref" data-text="Me gusta m√°s testear mec√°nicas nuevas">üéÆ Mec√°nicas</button>
      <button type="button" class="quick-btn" data-fill="beta_pref" data-text="Prefiero encontrar y reportar bugs">üêõ Bugs</button>
      <button type="button" class="quick-btn" data-fill="beta_pref" data-text="Me gusta hacer ambas cosas por igual">‚öñÔ∏è Ambas</button>
    </div>
    <div class="validation-msg" id="val-beta_pref"></div>
  </div>

  <!-- Final -->
  <div class="step-card" data-step="10">
    <label>
      üìù ¬øAlgo m√°s que a√±adir?
      <span class="char-count"><span id="extra-count">0</span>/1000</span>
    </label>
    <textarea name="extra" maxlength="1000" placeholder="Informaci√≥n adicional (opcional)"></textarea>
  </div>

  <!-- Captcha -->
  <div class="step-card" data-step="11">
    <label>ü§ñ Verificaci√≥n anti-spam <span class="required">*</span></label>
    <p style="margin:10px 0;color:rgba(255,255,255,.7)" id="captchaQuestion"></p>
    <input name="captcha" type="number" required placeholder="Tu respuesta">
    <div class="validation-msg" id="val-captcha"></div>
  </div>

  <!-- Email opcional -->
  <div class="step-card" data-step="12">
    <label>üìß Email (opcional para copia)</label>
    <input name="email" type="email" placeholder="tu@email.com">
    <p style="font-size:.85rem;color:rgba(255,255,255,.6);margin-top:8px">
      Si proporcionas tu email, te enviaremos una copia de tu postulaci√≥n
    </p>
  </div>

  <div class="controls">
    <button type="button" id="prevBtn" class="btn ghost">‚¨ÖÔ∏è Anterior</button>
    <button type="button" id="nextBtn" class="btn">‚û°Ô∏è Siguiente</button>
    <button type="submit" id="sendBtn" class="btn" style="display:none">üöÄ Enviar</button>
  </div>
</form>
<footer>
  <span>Creado con ‚ù§Ô∏è por</span> <a href="#">GodestMC</a>
</footer>
</div>

<script>
const webhookUrl = "https://discord.com/api/webhooks/1423267722862792805/2P-DP4l2RtxFF8oe6v2PfnOpT72ZnJQCC6rFu-X6oGY8iX_SbFwsRw6JEkFlsc4JJN6m";

// Variables globales
const form = document.getElementById("applyForm");
const steps = Array.from(document.querySelectorAll(".step-card"));
const bar = document.getElementById("bar");
const currentStepEl = document.getElementById("currentStep");
const totalStepsEl = document.getElementById("totalSteps");
const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");
const sendBtn = document.getElementById("sendBtn");
const themeToggle = document.getElementById("themeToggle");

let stepIndex = 0;
let chosenRole = null;
let startTime = Date.now();
let timerInterval;
let autoSaveData = {};
let captchaAnswer = 0;
let lastSubmitTime = 0;
const RATE_LIMIT_MS = 60000; // 1 minuto entre env√≠os

// Generar part√≠culas de fondo
function createParticles() {
  const container = document.getElementById('particles');
  for(let i = 0; i < 50; i++) {
    const particle = document.createElement('div');
    particle.className = 'particle';
    particle.style.left = Math.random() * 100 + '%';
    particle.style.animationDelay = Math.random() * 20 + 's';
    particle.style.animationDuration = (15 + Math.random() * 10) + 's';
    container.appendChild(particle);
  }
}
createParticles();

// Timer
function startTimer() {
  timerInterval = setInterval(() => {
    const elapsed = Math.floor((Date.now() - startTime) / 1000);
    const mins = Math.floor(elapsed / 60);
    const secs = elapsed % 60;
    document.getElementById('timer').textContent = `‚è±Ô∏è ${mins}:${secs.toString().padStart(2, '0')}`;
  }, 1000);
}
startTimer();

// Tema
themeToggle.onclick = () => {
  document.body.classList.toggle('light');
  themeToggle.textContent = document.body.classList.contains('light') ? '‚òÄÔ∏è' : 'üåô';
};

// Captcha
function generateCaptcha() {
  const num1 = Math.floor(Math.random() * 10) + 1;
  const num2 = Math.floor(Math.random() * 10) + 1;
  captchaAnswer = num1 + num2;
  document.getElementById('captchaQuestion').textContent = `¬øCu√°nto es ${num1} + ${num2}?`;
}
generateCaptcha();

// Geolocalizaci√≥n
document.getElementById('detectLocation').onclick = async () => {
  try {
    const res = await fetch('https://ipapi.co/json/');
    const data = await res.json();
    const offset = data.utc_offset;
    document.querySelector('input[name="country"]').value = `${data.country_name} (GMT${offset})`;
    validateField(document.querySelector('input[name="country"]'));
  } catch(e) {
    alert('No se pudo detectar la ubicaci√≥n');
  }
};

function getFilteredSteps() {
  return steps.filter(s => {
    if(s.classList.contains("staff-only")) return chosenRole==="staff";
    if(s.classList.contains("dev-only")) return chosenRole==="dev";
    if(s.classList.contains("beta-only")) return chosenRole==="beta";
    return true;
  });
}

function showStep(i){
  const filtered = getFilteredSteps();
  filtered.forEach((s,idx)=>s.classList.toggle("active",idx===i));
  bar.style.width = ((i+1)/filtered.length*100)+"%";
  currentStepEl.textContent = i+1;
  totalStepsEl.textContent = filtered.length;
  prevBtn.style.display = i===0?"none":"inline-block";
  nextBtn.style.display = i===filtered.length-1?"none":"inline-block";
  sendBtn.style.display = i===filtered.length-1?"inline-block":"none";
  validateStep();
  updateQuality();
  
  // Scroll suave al top
  window.scrollTo({top: 0, behavior: 'smooth'});
}

function validateField(field) {
  const name = field.name;
  const value = field.value.trim();
  const valMsg = document.getElementById(`val-${name}`);
  
  let isValid = true;
  let message = '';
  
  if(field.hasAttribute('required') && !value) {
    isValid = false;
    message = '‚ö†Ô∏è Este campo es obligatorio';
  } else if(name === 'discord' && value) {
    if(value.length < 2 || value.length > 37) {
      isValid = false;
      message = '‚ö†Ô∏è Nick de Discord inv√°lido';
    }
  } else if(name === 'mc' && value) {
    if(!/^[a-zA-Z0-9_]{3,16}$/.test(value)) {
      isValid = false;
      message = '‚ö†Ô∏è Nick debe tener 3-16 caracteres (solo letras, n√∫meros y _)';
    }
  } else if(name === 'hours' && value) {
    if(value < 1 || value > 168) {
      isValid = false;
      message = '‚ö†Ô∏è Debe ser entre 1 y 168 horas';
    }
  } else if(name === 'captcha' && value) {
    if(parseInt(value) !== captchaAnswer) {
      isValid = false;
      message = '‚ö†Ô∏è Respuesta incorrecta';
    } else {
      message = '‚úÖ Correcto';
    }
  }
  
  if(valMsg) {
    valMsg.textContent = message;
    valMsg.className = 'validation-msg show ' + (isValid && value ? 'success' : 'error');
  }
  
  field.className = value ? (isValid ? 'valid' : 'invalid') : '';
  return isValid;
}

function validateStep() {
  const filtered = getFilteredSteps();
  const currentFields = filtered[stepIndex].querySelectorAll("input[required],textarea[required],select[required]");
  const allFilled = Array.from(currentFields).every(f => {
    const isValid = f.value.trim() !== "";
    if(f.name === 'captcha' && isValid) {
      return parseInt(f.value) === captchaAnswer;
    }
    return isValid;
  });
  nextBtn.disabled = !allFilled;
  sendBtn.disabled = !allFilled;
}

function updateQuality() {
  const fd = new FormData(form);
  const data = Object.fromEntries(fd.entries());
  let score = 0;
  let total = 0;
  
  Object.entries(data).forEach(([key, value]) => {
    if(key === 'extra' || key === 'email') return; // Opcionales no cuentan
    total++;
    if(value.trim()) {
      score++;
      // Bonus por respuestas largas
      if(value.length > 100) score += 0.5;
      if(value.length > 300) score += 0.5;
    }
  });
  
  const percent = Math.min(100, Math.round((score / total) * 100));
  document.getElementById('qualityBar').style.width = percent + '%';
  document.getElementById('qualityPercent').textContent = percent + '%';
}

// Contador de caracteres
document.querySelectorAll('textarea[maxlength]').forEach(textarea => {
  const countId = textarea.name + '-count';
  textarea.addEventListener('input', () => {
    const count = textarea.value.length;
    const counter = document.getElementById(countId);
    if(counter) counter.textContent = count;
  });
});

// Validaci√≥n en tiempo real
steps.forEach(step => {
  step.querySelectorAll("input,textarea,select").forEach(field => {
    field.addEventListener("input", () => {
      validateField(field);
      validateStep();
      updateQuality();
      // Autoguardado
      autoSaveData[field.name] = field.value;
    });
    field.addEventListener("change", () => {
      validateField(field);
      validateStep();
      updateQuality();
    });
  });
});

// Botones de respuesta r√°pida
document.querySelectorAll('.quick-btn[data-fill]').forEach(btn => {
  btn.onclick = () => {
    const targetName = btn.dataset.fill;
    const text = btn.dataset.text;
    const field = document.querySelector(`[name="${targetName}"]`);
    if(field) {
      if(field.tagName === 'TEXTAREA') {
        field.value = field.value ? field.value + ', ' + text : text;
      } else {
        field.value = text;
      }
      validateField(field);
      validateStep();
      updateQuality();
    }
  };
});

nextBtn.onclick=()=>{
  const filtered = getFilteredSteps();
  if(stepIndex<filtered.length-1){
    stepIndex++;
    showStep(stepIndex);
    playSound();
  }
};

prevBtn.onclick=()=>{
  if(stepIndex>0){
    stepIndex--;
    showStep(stepIndex);
    playSound();
  }
};

document.querySelector("select[name='role']").addEventListener("change", e=>{
  chosenRole = e.target.value;
  stepIndex = 0;
  showStep(stepIndex);
});

// Sonidos (simulados con beep)
function playSound() {
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  const oscillator = audioCtx.createOscillator();
  const gainNode = audioCtx.createGain();
  
  oscillator.connect(gainNode);
  gainNode.connect(audioCtx.destination);
  
  oscillator.frequency.value = 800;
  oscillator.type = 'sine';
  
  gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
  gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
  
  oscillator.start(audioCtx.currentTime);
  oscillator.stop(audioCtx.currentTime + 0.1);
}

// Confetti
function createConfetti() {
  const colors = ['#ef4444', '#f59e0b', '#10b981', '#3b82f6', '#8b5cf6', '#ec4899'];
  for(let i = 0; i < 100; i++) {
    setTimeout(() => {
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      confetti.style.left = Math.random() * 100 + '%';
      confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
      confetti.style.animationDelay = Math.random() * 0.5 + 's';
      document.body.appendChild(confetti);
      setTimeout(() => confetti.remove(), 3000);
    }, i * 20);
  }
}

// Vibraci√≥n m√≥vil
function vibrate() {
  if(navigator.vibrate) {
    navigator.vibrate(200);
  }
}

// Konami Code Easter Egg
let konamiCode = [];
const konamiSequence = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
document.addEventListener('keydown', e => {
  konamiCode.push(e.key);
  if(konamiCode.length > 10) konamiCode.shift();
  if(JSON.stringify(konamiCode) === JSON.stringify(konamiSequence)) {
    document.body.classList.toggle('konami-active');
    alert('üéÆ ¬°KONAMI CODE ACTIVADO! üéÆ');
  }
});

// Gestos t√°ctiles
let touchStartX = 0;
let touchEndX = 0;
document.querySelector('.container').addEventListener('touchstart', e => {
  touchStartX = e.changedTouches[0].screenX;
});
document.querySelector('.container').addEventListener('touchend', e => {
  touchEndX = e.changedTouches[0].screenX;
  handleSwipe();
});
function handleSwipe() {
  if(touchEndX < touchStartX - 50) nextBtn.click(); // Swipe left
  if(touchEndX > touchStartX + 50) prevBtn.click(); // Swipe right
}

form.onsubmit = async e => {
  e.preventDefault();
  
  // Rate limiting
  const now = Date.now();
  if(now - lastSubmitTime < RATE_LIMIT_MS) {
    const waitTime = Math.ceil((RATE_LIMIT_MS - (now - lastSubmitTime)) / 1000);
    alert(`‚è≥ Espera ${waitTime} segundos antes de enviar otra postulaci√≥n`);
    vibrate();
    return;
  }
  
  sendBtn.disabled = true;
  sendBtn.innerHTML = '‚è≥ Enviando...';
  
  const fd = new FormData(form);
  const data = Object.fromEntries(fd.entries());
  
  // Generar ID √∫nico
  const appId = 'APP-' + Date.now().toString(36).toUpperCase() + '-' + Math.random().toString(36).substr(2, 5).toUpperCase();
  
  const fieldNames = {
    role: "üéØ Rol",
    discord: "üí¨ Discord",
    mc: "üéÆ Minecraft",
    exp: "üìã Experiencia Previa",
    country: "üåç Pa√≠s/Zona Horaria",
    hours: "‚è∞ Horas Semanales",
    days: "üìÖ D√≠as Disponibles",
    staff_conflict: "‚öñÔ∏è Resoluci√≥n de Conflictos",
    staff_motive: "üí° Motivaci√≥n (Staff)",
    dev_langs: "üíª Lenguajes de Programaci√≥n",
    dev_events: "üîß Manejo de Eventos Minecraft",
    beta_motive: "üí° Motivaci√≥n (Beta Tester)",
    beta_pref: "üîç Preferencia de Testing",
    extra: "üìù Informaci√≥n Adicional",
    email: "üìß Email"
  };

  const fields = [];
  for (const [key, value] of Object.entries(data)) {
    if(key === 'captcha') continue;
    if (value && value.trim() !== "") {
      fields.push({
        name: fieldNames[key] || key,
        value: value.substring(0, 1024),
        inline: key === 'role' || key === 'hours'
      });
    }
  }
  
  // Calcular tiempo total
  const totalTime = Math.floor((Date.now() - startTime) / 1000);
  const mins = Math.floor(totalTime / 60);
  const secs = totalTime % 60;
  
  fields.push({
    name: "‚è±Ô∏è Tiempo completado",
    value: `${mins}m ${secs}s`,
    inline: true
  });
  
  fields.push({
    name: "üÜî ID de Postulaci√≥n",
    value: appId,
    inline: true
  });

  const payload = {
    username: "Postulaciones GodestMC",
    avatar_url: "https://i.imgur.com/8eU3Ggk.png",
    content: `@everyone Nueva postulaci√≥n recibida!`,
    embeds: [{
      title: "üì© Nueva Postulaci√≥n ‚Äî GodestMC",
      description: `**Rol solicitado:** ${data.role.toUpperCase()}\n**ID:** \`${appId}\``,
      color: data.role === 'staff' ? 0x10b981 : data.role === 'dev' ? 0x3b82f6 : 0x8b5cf6,
      fields: fields,
      thumbnail: {
        url: `https://mc-heads.net/avatar/${data.mc || 'Steve'}/128`
      },
      footer: {
        text: "GodestMC ‚Äî Sistema de Postulaci√≥n v2.0"
      },
      timestamp: new Date().toISOString()
    }]
  };

  try {
    const res = await fetch(webhookUrl, {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify(payload)
    });

    if (res.ok) {
      lastSubmitTime = Date.now();
      clearInterval(timerInterval);
      createConfetti();
      vibrate();
      
      document.querySelector(".container").innerHTML = `
        <div class="success-screen">
          <h1 style="font-size:5rem;margin-bottom:20px;animation:bounce 1s ease">‚úÖ</h1>
          <h2 style="font-size:2rem;margin-bottom:15px;color:#10b981">¬°Postulaci√≥n enviada!</h2>
          <p style="margin-top:12px;font-size:1.1rem;color:#e2e8f0;line-height:1.8;max-width:500px;margin-left:auto;margin-right:auto">
            Tu solicitud ha sido recibida correctamente.<br><br>
            <strong>Recuerda abrir un ticket en Discord para completar el proceso con las pruebas finales.</strong>
          </p>
          <div class="app-id">
            ${appId}
          </div>
          <p style="margin-top:20px;font-size:1rem;color:rgba(255,255,255,0.7)">
            ¬°Buena suerte! üçÄ
          </p>
          <p style="margin-top:30px;font-size:0.9rem;color:rgba(255,255,255,0.5)">
            ‚è±Ô∏è Completado en ${mins}m ${secs}s
          </p>
        </div>
      `;
      
      playSound();
    } else {
      const errText = await res.text();
      alert("‚ùå Error al enviar: " + res.status + "\n" + errText);
      sendBtn.disabled = false;
      sendBtn.innerHTML = 'üöÄ Enviar';
      vibrate();
    }
  } catch(err) {
    alert("‚ùå Error de conexi√≥n: " + err.message);
    sendBtn.disabled = false;
    sendBtn.innerHTML = 'üöÄ Enviar';
    vibrate();
  }
};

// Inicializar
showStep(stepIndex);
updateQuality();

// Auto-guardar recordatorio
window.addEventListener('beforeunload', e => {
  const hasData = Object.keys(autoSaveData).length > 0;
  if(hasData && stepIndex < getFilteredSteps().length - 1) {
    e.preventDefault();
    e.returnValue = '';
  }
});

console.log('%cüéÆ GodestMC Form v2.0', 'font-size:20px;color:#0ea5e9;font-weight:bold');
console.log('%cTip: Intenta el Konami Code... üëæ', 'color:#10b981');
</script>
</body>
</html>
